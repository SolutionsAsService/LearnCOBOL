IDENTIFICATION DIVISION.
PROGRAM-ID. InventoryOrderProcessing.
AUTHOR. Your Name.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT inventory-file ASSIGN TO 'inventory-file.dat'.
    SELECT order-file ASSIGN TO 'order-file.dat'.
    SELECT restock-file ASSIGN TO 'restock-file.dat'.

DATA DIVISION.
FILE SECTION.
FD inventory-file.
01 INVENTORY-RECORD.
    05 PRODUCT-CODE       PIC X(10).
    05 PRODUCT-NAME       PIC X(25).
    05 CURRENT-STOCK      PIC 9(5).
    05 MIN-STOCK-LEVEL    PIC 9(5).
    05 RESTOCK-QUANTITY   PIC 9(5).

FD order-file.
01 ORDER-RECORD.
    05 ORDER-ID           PIC X(10).
    05 O-PRODUCT-CODE     PIC X(10).
    05 ORDER-QUANTITY     PIC 9(5).

FD restock-file.
01 RESTOCK-RECORD.
    05 R-PRODUCT-CODE     PIC X(10).
    05 RESTOCK-AMOUNT     PIC 9(5).

WORKING-STORAGE SECTION.
01 WS-END-OF-FILE       PIC X VALUE 'N'.
    88 EOF              VALUE 'Y'.
    88 NOT-EOF          VALUE 'N'.

PROCEDURE DIVISION.
BEGIN.
    OPEN INPUT inventory-file order-file
        OUTPUT restock-file
    PERFORM PROCESS-ORDERS UNTIL EOF
    CLOSE inventory-file order-file restock-file
    STOP RUN.

PROCESS-ORDERS.
    READ order-file INTO ORDER-RECORD AT END SET EOF TO TRUE.
    PERFORM UNTIL EOF
        PERFORM UPDATE-INVENTORY
        READ order-file INTO ORDER-RECORD AT END SET EOF TO TRUE.
    END-PERFORM.

UPDATE-INVENTORY.
    PERFORM VARYING I FROM 1 BY 1 UNTIL EOF OR PRODUCT-CODE = O-PRODUCT-CODE
        READ inventory-file INTO INVENTORY-RECORD AT END SET EOF TO TRUE
    END-PERFORM
    IF PRODUCT-CODE = O-PRODUCT-CODE
        SUBTRACT ORDER-QUANTITY FROM CURRENT-STOCK
        IF CURRENT-STOCK < MIN-STOCK-LEVEL
            PERFORM TRIGGER-RESTOCK
        END-IF
        REWRITE INVENTORY-RECORD
    END-IF.

TRIGGER-RESTOCK.
    MOVE PRODUCT-CODE TO R-PRODUCT-CODE
    MOVE RESTOCK-QUANTITY TO RESTOCK-AMOUNT
    WRITE RESTOCK-RECORD.
