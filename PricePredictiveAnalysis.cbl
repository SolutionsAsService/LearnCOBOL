IDENTIFICATION DIVISION.
PROGRAM-ID. PricePredictiveAnalysis.
AUTHOR. Your Name.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT historical-prices ASSIGN TO 'historical-prices.dat'.
    SELECT price-predictions ASSIGN TO 'price-predictions.dat'.

DATA DIVISION.
FILE SECTION.
FD historical-prices.
01 HISTORICAL-PRICE-RECORD.
    05 STOCK-SYMBOL        PIC X(10).
    05 DATE-OF-PRICE       PIC 9(8).
    05 PRICE               PIC 9(5)V99.

FD price-predictions.
01 PREDICTION-RECORD.
    05 P-STOCK-SYMBOL      PIC X(10).
    05 P-PREDICTED-PRICE   PIC 9(5)V99.

WORKING-STORAGE SECTION.
01 AVERAGE-PRICE-CHANGE    PIC 9(5)V99.
01 TOTAL-PRICE-CHANGE      PIC 9(5)V99 VALUE 0.
01 PREVIOUS-PRICE          PIC 9(5)V99.
01 PRICE-COUNT             PIC 9(3) VALUE 0.
01 WS-END-OF-FILE          PIC X VALUE 'N'.
    88 EOF                 VALUE 'Y'.
    88 NOT-EOF             VALUE 'N'.

PROCEDURE DIVISION.
BEGIN.
    OPEN INPUT historical-prices
        OUTPUT price-predictions
    PERFORM READ-FIRST-RECORD
    PERFORM PROCESS-RECORDS UNTIL EOF
    PERFORM CALCULATE-PREDICTION
    CLOSE historical-prices price-predictions
    STOP RUN.

READ-FIRST-RECORD.
    READ historical-prices INTO HISTORICAL-PRICE-RECORD AT END SET EOF TO TRUE.
    IF NOT EOF
        MOVE PRICE TO PREVIOUS-PRICE
    END-IF.

PROCESS-RECORDS.
    READ historical-prices INTO HISTORICAL-PRICE-RECORD AT END SET EOF TO TRUE.
    IF NOT EOF
        PERFORM UPDATE-TOTAL-CHANGE
        MOVE PRICE TO PREVIOUS-PRICE
    END-IF.

UPDATE-TOTAL-CHANGE.
    COMPUTE TOTAL-PRICE-CHANGE = TOTAL-PRICE-CHANGE + (PRICE - PREVIOUS-PRICE).
    ADD 1 TO PRICE-COUNT.

CALCULATE-PREDICTION.
    IF PRICE-COUNT > 0
        COMPUTE AVERAGE-PRICE-CHANGE = TOTAL-PRICE-CHANGE / PRICE-COUNT
        COMPUTE P-PREDICTED-PRICE = PREVIOUS-PRICE + AVERAGE-PRICE-CHANGE
        MOVE STOCK-SYMBOL TO P-STOCK-SYMBOL
        WRITE PREDICTION-RECORD
    END-IF.
